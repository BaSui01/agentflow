// 版权所有 2024 AgentFlow Authors. 版权所有。
// 此源代码的使用由 MIT 许可规范,该许可可以是
// 在LICENSE文件中找到。

/*
包内存为AI代理提供了分层内存系统.

# 概览

内存包执行一个多层次的内存架构,灵感来自
人类认知系统. 它提供不同的内存类型 优化用于
各种使用案例,使代理人能够保持环境,学习经验,
并回顾有关资料。

# 记忆结构

	┌─────────────────────────────────────────────────────────────┐
	QQ 内存管理器 QQ
	* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * ** * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * ** * * * * * * * * * * * * * * **** *** *******
	├─────────────────────────────────────────────────────────────┤
	│  ┌─────────────────────────────────────────────────────────┐│
	工作记忆
	QQ (短期、 高优先级、 TTL 到期) QQ
	│  └─────────────────────────────────────────────────────────┘│
	│  ┌─────────────────────────────────────────────────────────┐│
	{\fn黑体\fs22\bord1\shad0\3aHBE\4aH00\fscx67\fscy66\2cHFFFFFF\3cH808080}我记得你
	* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * ******************************************
	│  └─────────────────────────────────────────────────────────┘│
	│  ┌─────────────────────────────────────────────────────────┐│
	语义记忆
	QQ( 事实知识, 主题 - 对象) QQ
	│  └─────────────────────────────────────────────────────────┘│
	│  ┌─────────────────────────────────────────────────────────┐│
	程序记忆
	(如何掌握知识、技能、程序)
	│  └─────────────────────────────────────────────────────────┘│
	└─────────────────────────────────────────────────────────────┘

# 记忆类型

工作内存:以TTL为基础的短期上下文存储.
最佳对象:当前对话背景,临时变量,活性目标.

	mim:=内存. New Working Memory (100, 5* time). 分钟,伐木机)
	妈妈。 设置( “当前  专题”、“ 天气” 1)
	值, OK: = mem.Get( “当前  专题”)

Episodic Memory:基于事件的经验与时序.
最佳用途:对话历史,用户互动,任务结果.

	mem:=内存. NewEpisodic Memory (10,000, logger) (英语).
	妈妈。 存储( M) 。 第1集{
	    背景:"用户询问天气",
	    行动: "呼叫天气API",
	    结果:"回光了,25°C"
	    重要性:0.8,
	})
	最近:=mem. 回顾(10)

语义记忆:将事实知识作为主体-先入为主-对象三重存储.
最佳用途:域知识,用户偏好,学到的事实.

	mem:=内存. NewSemantic Memory (embedder, logger) (英语).
	mem.StoreFact(ctx, & memory). 事实{
	    题目: "巴黎",
	    预告:"是资本",
	    对象:"法国",
	    信任度:0.99,
	})
	事实 := mem.Query ("巴黎")

程序记忆:如何掌握知识和技能.
最佳用途:任务程序,工作流程,学习行为.

# 内存条目

跨内存类型使用的基础内存 Entry 结构 :

	类型 内存 Entry struct {
	    标识字符串
	    类型内存类型
	    内容字符串
	    嵌入 [] float32
	    重要性浮点64
	    访问输入
	    时所造已. 时间
	    最后一次进入时间。 时间
	    过期时间 。 时间
	    元数据映射[字符串]
	    关系
	}

# 巩固战略

该软件包支持用于传输的内存整合策略
内存层间的信息 :

	策略 := 内存. NewImport Configation( & memory. Config{
	    重要门槛:0.7,
	    最小访问数 : 3,
	    24*时间。 小时
	})

	// 将工作记忆整合为零星记忆
	战略。 合并( ctx, 工作备忘录, 缩写)

# 聪明的衰败

使用可配置的衰变函数,内存重要性随时间推移而衰减:

	衰减 := 内存. NewIntelligentDecay( &memory.Decay Config{
	    半生:7 *24 *时间. 小时
	    重要性:0.1,
	    衰变功能:记忆. 鉴证Decay,
	})

# 向量存储集成

语义内存支持向量嵌入相似性搜索:

	// 用嵌入器进行语义搜索
	mem:=内存. NewSemantic Memory (embedder, logger) (英语).

	// 以相似性搜索
	结果 : = mem.SearchSimular(ctx,查询Embedding, 10)

记忆存储器

用于基本内存需要的简单密钥值存储 :

	存储 := 内存. New InMemoryStore (1000, 日志)
	存储。 设置( ctx, “ key”, 值, ttl)
	值,错误:=存储。 获取( ctx, "键" )

线索安全

所有内存执行都是安全的,可以同时使用
从多条出道道。 他们使用适当的同步原始
(sync.RWMutex)保护共享状态.

# 表现

软件包对性能进行了优化:

	基准Episodic Memory Store-12 449977 292.6 ns/op 198 B/op 3 alogs/op
	基准记忆 回顾12 1302644 90.26 ns/op 80 B/op 1 alogs/op
	基准语义记忆- 12 234567 456.7 ns/op 120 B/op 2 alogs/op

# 与代理人融合

内存与代理框架无缝地融合:

	代理, 错误 := 代理. NewAgentBuilder( config).
	    与 Provider( 提供者) 。
	    带有 Memory( 记忆管理器) 。
	    构建( C)

代理自动使用内存 :
  - 保持对话的背景
  - 积累和总结相关经验
  - 从互动中学习
  - 个性化对策

# 最佳做法

1. 为您的使用选择正确的内存类型
2. 制定适当的能力限制,防止无限制的增长
3. 利用重要分数确定有价值记忆的优先次序
4. 实施长期机构合并
5. 将TTL视为具有时间敏感性的信息
6. 语义相似性搜索使用嵌入
*/
package memory
