# =============================================================================
# ğŸ” AgentFlow golangci-lint é…ç½®
# =============================================================================
# å…¨é¢çš„ä»£ç è´¨é‡æ£€æŸ¥é…ç½®ï¼Œè¦†ç›–é”™è¯¯å¤„ç†ã€ä»£ç é£æ ¼ã€å®‰å…¨æ€§ç­‰å¤šä¸ªç»´åº¦
# æ–‡æ¡£: https://golangci-lint.run/usage/configuration/
# =============================================================================

run:
  timeout: 5m
  # è·³è¿‡æµ‹è¯•æ–‡ä»¶ä¸­çš„æŸäº›æ£€æŸ¥ï¼ˆå¯é€‰ï¼‰
  tests: true
  # å¹¶å‘æ•°
  concurrency: 4

# -----------------------------------------------------------------------------
# Linters é…ç½®
# -----------------------------------------------------------------------------
linters:
  disable-all: true
  enable:
    # ========== æ ¸å¿ƒæ£€æŸ¥å™¨ (å¿…é¡») ==========
    - govet          # Go å®˜æ–¹é™æ€åˆ†æå·¥å…·ï¼Œæ£€æŸ¥å¯ç–‘ä»£ç ç»“æ„
    - staticcheck    # é«˜çº§é™æ€åˆ†æï¼Œæ£€æŸ¥ bugã€æ€§èƒ½é—®é¢˜ã€ä»£ç ç®€åŒ–
    - errcheck       # ğŸ†• æ£€æŸ¥æœªå¤„ç†çš„é”™è¯¯è¿”å›å€¼ï¼ˆè¶…çº§é‡è¦ï¼ï¼‰
    - gosimple       # ğŸ†• ä»£ç ç®€åŒ–å»ºè®®
    - ineffassign    # ğŸ†• æ£€æµ‹æ— æ•ˆèµ‹å€¼
    - unused         # ğŸ†• æ£€æµ‹æœªä½¿ç”¨çš„ä»£ç 
    - typecheck      # ç±»å‹æ£€æŸ¥

    # ========== ä»£ç é£æ ¼ ==========
    - gocritic       # ğŸ†• ä»£ç é£æ ¼å’Œæ€§èƒ½æ£€æŸ¥
    - gofmt          # æ ¼å¼åŒ–æ£€æŸ¥
    - goimports      # import æ’åºæ£€æŸ¥
    - misspell       # ğŸ†• æ‹¼å†™æ£€æŸ¥

    # ========== å®‰å…¨æ€§ ==========
    - gosec          # ğŸ†• å®‰å…¨æ¼æ´æ£€æŸ¥ï¼ˆSQLæ³¨å…¥ã€ç¡¬ç¼–ç å¯†é’¥ç­‰ï¼‰

    # ========== ä»£ç å¤æ‚åº¦ ==========
    - gocyclo        # ğŸ†• åœˆå¤æ‚åº¦æ£€æŸ¥
    - gocognit       # ğŸ†• è®¤çŸ¥å¤æ‚åº¦æ£€æŸ¥

    # ========== æœ€ä½³å®è·µ ==========
    - nolintlint     # ğŸ†• æ£€æŸ¥ nolint æŒ‡ä»¤çš„è§„èŒƒæ€§
    - exportloopref  # ğŸ†• æ£€æŸ¥å¾ªç¯å˜é‡å¯¼å‡ºé—®é¢˜
    - prealloc       # ğŸ†• å»ºè®®é¢„åˆ†é…åˆ‡ç‰‡å®¹é‡
    - unconvert      # ğŸ†• æ£€æµ‹ä¸å¿…è¦çš„ç±»å‹è½¬æ¢
    - unparam        # ğŸ†• æ£€æµ‹æœªä½¿ç”¨çš„å‡½æ•°å‚æ•°
    - nakedret       # ğŸ†• æ£€æŸ¥è£¸è¿”å›è¯­å¥
    - bodyclose      # ğŸ†• æ£€æŸ¥ HTTP response body æ˜¯å¦å…³é—­

# -----------------------------------------------------------------------------
# Linters è¯¦ç»†è®¾ç½®
# -----------------------------------------------------------------------------
linters-settings:
  # åœˆå¤æ‚åº¦é˜ˆå€¼ï¼ˆè¶…è¿‡æ­¤å€¼ä¼šè­¦å‘Šï¼‰
  gocyclo:
    min-complexity: 15

  # è®¤çŸ¥å¤æ‚åº¦é˜ˆå€¼
  gocognit:
    min-complexity: 20

  # gocritic æ£€æŸ¥å™¨é…ç½®
  gocritic:
    enabled-tags:
      - diagnostic    # è¯Šæ–­ç±»æ£€æŸ¥
      - style         # é£æ ¼ç±»æ£€æŸ¥
      - performance   # æ€§èƒ½ç±»æ£€æŸ¥
    disabled-checks:
      - ifElseChain   # å…è®¸ if-else é“¾ï¼ˆæœ‰æ—¶æ¯” switch æ›´æ¸…æ™°ï¼‰
      - hugeParam     # å¤§å‚æ•°æ£€æŸ¥ï¼ˆæŸäº›åœºæ™¯éœ€è¦ï¼‰

  # gosec å®‰å…¨æ£€æŸ¥é…ç½®
  gosec:
    excludes:
      - G104  # å®¡è®¡æœªæ£€æŸ¥çš„é”™è¯¯ï¼ˆerrcheck å·²è¦†ç›–ï¼‰
    config:
      global:
        audit: enabled

  # errcheck é…ç½®
  errcheck:
    check-type-assertions: true  # æ£€æŸ¥ç±»å‹æ–­è¨€
    check-blank: true            # æ£€æŸ¥ _ = err çš„æƒ…å†µ

  # misspell é…ç½®
  misspell:
    locale: US

  # nakedret é…ç½®ï¼ˆå‡½æ•°ä½“è¶…è¿‡æ­¤è¡Œæ•°ç¦æ­¢è£¸è¿”å›ï¼‰
  nakedret:
    max-func-lines: 30

  # govet é…ç½®
  govet:
    enable-all: true
    disable:
      - fieldalignment  # å­—æ®µå¯¹é½æ£€æŸ¥ï¼ˆæœ‰æ—¶ä¼šå½±å“å¯è¯»æ€§ï¼‰

# -----------------------------------------------------------------------------
# é—®é¢˜è¿‡æ»¤å’Œæ’é™¤
# -----------------------------------------------------------------------------
issues:
  # æ’é™¤è§„åˆ™
  exclude-rules:
    # æµ‹è¯•æ–‡ä»¶ä¸­å…è®¸ä¸€äº›å®½æ¾çš„è§„åˆ™
    - path: _test\.go
      linters:
        - errcheck      # æµ‹è¯•ä¸­æœ‰æ—¶æ•…æ„å¿½ç•¥é”™è¯¯
        - gosec         # æµ‹è¯•ä¸­å¯èƒ½æœ‰ç¡¬ç¼–ç çš„æµ‹è¯•æ•°æ®
        - gocyclo       # æµ‹è¯•å‡½æ•°å¯èƒ½è¾ƒå¤æ‚
        - gocognit      # æµ‹è¯•å‡½æ•°å¯èƒ½è¾ƒå¤æ‚
        - unparam       # æµ‹è¯•ä¸­å¯èƒ½æœ‰æœªä½¿ç”¨çš„å‚æ•°

    # ç¤ºä¾‹æ–‡ä»¶ä¸­å…è®¸å®½æ¾è§„åˆ™
    - path: example_
      linters:
        - errcheck
        - unused

    # ç”Ÿæˆçš„ä»£ç æ’é™¤
    - path: \.pb\.go$
      linters:
        - all

    # mock æ–‡ä»¶æ’é™¤
    - path: mock_
      linters:
        - all

  # æœ€å¤§åŒç±»é—®é¢˜æ•°ï¼ˆ0 = æ— é™åˆ¶ï¼‰
  max-same-issues: 0

  # æœ€å¤§é—®é¢˜æ•°ï¼ˆ0 = æ— é™åˆ¶ï¼‰
  max-issues-per-linter: 0

  # æ˜¾ç¤ºæ–°é—®é¢˜ï¼ˆç›¸å¯¹äºåŸºå‡†ï¼‰
  new: false

# -----------------------------------------------------------------------------
# è¾“å‡ºé…ç½®
# -----------------------------------------------------------------------------
output:
  formats:
    - format: colored-line-number
  print-issued-lines: true
  print-linter-name: true
  sort-results: true

# -----------------------------------------------------------------------------
# ä¸¥é‡æ€§é…ç½®
# -----------------------------------------------------------------------------
severity:
  default-severity: warning
  rules:
    - linters:
        - errcheck
        - gosec
      severity: error
