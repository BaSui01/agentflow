# Multi-Agent Collaboration

AgentFlow supports multiple collaboration patterns including hierarchical agents, debate, consensus, pipeline, broadcast, and network modes.

## Hierarchical Agent (Supervisor-Worker)

```go
import "github.com/BaSui01/agentflow/agent/hierarchical"

supervisor := createSupervisorAgent(provider, logger)
workers := []agent.Agent{
    createWorkerAgent("researcher", provider, logger),
    createWorkerAgent("analyst", provider, logger),
    createWorkerAgent("writer", provider, logger),
}

hierarchicalAgent := hierarchical.NewHierarchicalAgent(
    baseAgent,
    supervisor,
    workers,
    hierarchical.HierarchicalConfig{
        MaxWorkers:        5,
        TaskTimeout:       5 * time.Minute,
        EnableRetry:       true,
        MaxRetries:        3,
        WorkerSelection:   "least_loaded",
        EnableLoadBalance: true,
    },
    logger,
)

result, err := hierarchicalAgent.Execute(ctx, &agent.Input{
    Content: "Research Go concurrency and write a technical report",
})
```

### Worker Selection Strategies

| Strategy | Description |
|----------|-------------|
| `round_robin` | Distribute evenly |
| `least_loaded` | Select least busy worker |
| `random` | Random selection |

## Multi-Agent System

```go
import "github.com/BaSui01/agentflow/agent/collaboration"

agents := []agent.Agent{
    createAgent("expert1", "You are an optimistic analyst"),
    createAgent("expert2", "You are a cautious risk assessor"),
    createAgent("expert3", "You are an innovative strategist"),
}

mas := collaboration.NewMultiAgentSystem(agents, collaboration.MultiAgentConfig{
    Pattern:            collaboration.PatternDebate,
    MaxRounds:          5,
    ConsensusThreshold: 0.7,
    Timeout:            10 * time.Minute,
    EnableVoting:       true,
}, logger)

result, err := mas.Execute(ctx, &agent.Input{
    Content: "Evaluate this investment proposal",
})
```

### Collaboration Patterns

#### Debate Pattern
Multiple agents propose views and critique each other:
```go
mas := collaboration.NewMultiAgentSystem(agents, collaboration.MultiAgentConfig{
    Pattern:   collaboration.PatternDebate,
    MaxRounds: 5,
}, logger)
```

#### Consensus Pattern
All agents vote to reach agreement:
```go
mas := collaboration.NewMultiAgentSystem(agents, collaboration.MultiAgentConfig{
    Pattern:            collaboration.PatternConsensus,
    ConsensusThreshold: 0.7,
}, logger)
```

#### Pipeline Pattern
Sequential processing, output becomes next input:
```go
mas := collaboration.NewMultiAgentSystem(agents, collaboration.MultiAgentConfig{
    Pattern: collaboration.PatternPipeline,
}, logger)
// Flow: Agent1 → Agent2 → Agent3
```

#### Broadcast Pattern
Parallel processing, aggregate results:
```go
mas := collaboration.NewMultiAgentSystem(agents, collaboration.MultiAgentConfig{
    Pattern: collaboration.PatternBroadcast,
}, logger)
```

#### Network Pattern
Free communication between agents:
```go
mas := collaboration.NewMultiAgentSystem(agents, collaboration.MultiAgentConfig{
    Pattern: collaboration.PatternNetwork,
}, logger)
```

## Message Hub

```go
hub := collaboration.NewMessageHub(logger)
hub.CreateChannel("agent1")
hub.CreateChannel("agent2")

hub.Send(&collaboration.Message{
    FromID:  "agent1",
    ToID:    "agent2",
    Type:    collaboration.MessageTypeProposal,
    Content: "I suggest option A",
})

msg, err := hub.Receive("agent2", 30*time.Second)
```

## A2A Protocol

Agent-to-Agent protocol for cross-system interoperability:

```go
import "github.com/BaSui01/agentflow/agent/a2a"

card := a2a.NewAgentCard(
    "code-reviewer",
    "Professional code review agent",
    "https://api.example.com/agents/code-reviewer",
    "1.0.0",
).
    AddCapability("review", "Review code quality", a2a.CapabilityTypeTask).
    AddTool("analyze_code", "Analyze code structure", schema).
    SetMetadata("language", "go,python")

// A2A Client
client := a2a.NewClient(config)
agents, _ := client.Discover(ctx, "code review")
response, _ := client.Call(ctx, agentURL, request)

// A2A Server
server := a2a.NewServer(a2a.ServerConfig{Port: 8080, Card: card})
server.RegisterHandler("review", reviewHandler)
server.Start()
```

## Crew Pattern

Team collaboration similar to CrewAI:

```go
import "github.com/BaSui01/agentflow/agent/crews"

crew := crews.NewCrew(crews.CrewConfig{
    Name:    "Research Team",
    Process: crews.ProcessSequential,
})

crew.AddMember(crews.Member{Agent: researcherAgent, Role: "Researcher"})
crew.AddMember(crews.Member{Agent: analystAgent, Role: "Analyst"})
crew.AddMember(crews.Member{Agent: writerAgent, Role: "Writer"})

crew.AddTask(crews.Task{Description: "Research topic", AssignedTo: "Researcher"})
crew.AddTask(crews.Task{Description: "Analyze data", AssignedTo: "Analyst", DependsOn: []string{"Research topic"}})
crew.AddTask(crews.Task{Description: "Write report", AssignedTo: "Writer", DependsOn: []string{"Analyze data"}})

result, err := crew.Kickoff(ctx)
```

## Best Practices

1. Choose appropriate pattern for the task
2. Limit debate rounds (3-5 usually sufficient)
3. Set reasonable timeouts for multi-agent tasks
4. Handle individual agent failures gracefully
5. Log inter-agent messages for debugging
