# AgentFlow 快速开始指南

## 简介

AgentFlow 是一个高性能的 Go 语言 AI Agent 框架，提供统一的 LLM 抽象层、智能路由、工具调用和工作流编排能力。

## 安装

```bash
go get github.com/BaSui01/agentflow
```

## 核心概念

### 1. Provider（提供商）

Provider 是 LLM 服务的统一抽象接口，支持 OpenAI、Claude、Gemini、DeepSeek 等多种提供商。

```go
import (
    "github.com/BaSui01/agentflow/llm/providers"
    "github.com/BaSui01/agentflow/llm/providers/openai"
)

// 创建 OpenAI Provider
provider := openai.NewOpenAIProvider(providers.OpenAIConfig{
    APIKey:  os.Getenv("OPENAI_API_KEY"),
    BaseURL: "https://api.openai.com",
    Model:   "gpt-4",
}, logger)
```

### 2. Agent（智能体）

Agent 是框架的核心执行单元，封装了状态管理、记忆、工具调用等能力。

```go
import "github.com/BaSui01/agentflow/agent"

// 创建 Agent 配置
cfg := agent.Config{
    ID:          "my-agent",
    Name:        "助手",
    Type:        agent.TypeAssistant,
    Model:       "gpt-4",
    MaxTokens:   4096,
    Temperature: 0.7,
}

// 创建 Agent
myAgent := agent.NewBaseAgent(cfg, provider, memory, toolManager, eventBus, logger)

// 初始化
if err := myAgent.Init(ctx); err != nil {
    log.Fatal(err)
}

// 执行任务
output, err := myAgent.Execute(ctx, &agent.Input{
    TraceID: "trace-001",
    Content: "请帮我分析这段代码",
})
```

### 3. 工具调用（Tool Calling）

框架支持原生工具调用，通过 ReAct 循环自动处理 LLM → Tool → LLM 的多轮对话。

```go
import "github.com/BaSui01/agentflow/llm/tools"

// 注册工具
registry := tools.NewDefaultRegistry(logger)
registry.Register("search", searchFunc, tools.ToolMetadata{
    Schema: llm.ToolSchema{
        Name:        "search",
        Description: "搜索信息",
        Parameters:  json.RawMessage(`{"type":"object","properties":{"query":{"type":"string"}}}`),
    },
    Timeout: 30 * time.Second,
})

// 创建执行器
executor := tools.NewDefaultExecutor(registry, logger)

// ReAct 循环自动处理工具调用
reactExecutor := tools.NewReActExecutor(provider, executor, tools.ReActConfig{
    MaxIterations: 10,
    StopOnError:   false,
}, logger)
```

## 数据流架构

```
用户输入 → Agent.Execute()
    ↓
输入验证 (Guardrails)
    ↓
构建消息 (System Prompt + Context + User Input)
    ↓
LLM 调用 (Provider.Completion/Stream)
    ↓
[如果有工具调用] → ReAct 循环
    ↓                   ↓
    ↓              工具执行
    ↓                   ↓
    ↓              结果返回 LLM
    ↓                   ↓
    ←←←←←←←←←←←←←←←←←←←
    ↓
输出验证 (Guardrails)
    ↓
保存记忆
    ↓
返回结果
```

## 弹性能力

### 重试机制

```go
import "github.com/BaSui01/agentflow/llm/retry"

policy := &retry.RetryPolicy{
    MaxRetries:   3,
    InitialDelay: 1 * time.Second,
    MaxDelay:     30 * time.Second,
    Multiplier:   2.0,
    Jitter:       true, // 防止雪崩
}

retryer := retry.NewBackoffRetryer(policy, logger)
```

### 熔断器

```go
import "github.com/BaSui01/agentflow/llm/circuitbreaker"

breaker := circuitbreaker.NewCircuitBreaker(&circuitbreaker.Config{
    Threshold:        5,  // 连续失败 5 次触发熔断
    ResetTimeout:     60 * time.Second,
    HalfOpenMaxCalls: 3,
}, logger)
```

### 弹性 Provider

```go
import "github.com/BaSui01/agentflow/llm"

resilientProvider := llm.NewResilientProviderSimple(
    provider,
    idempotencyManager,
    logger,
)
```

## 下一步

- [02.Provider 配置指南](02.Provider配置指南.md)
- [03.Agent 开发教程](03.Agent开发教程.md)
- [04.工具集成说明](04.工具集成说明.md)
- [05.工作流编排](05.工作流编排.md)
- [06.多模态处理](06.多模态处理.md)
- [07.检索增强RAG](07.检索增强RAG.md)
- [08.多Agent协作](08.多Agent协作.md)
