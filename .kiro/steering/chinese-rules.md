---
inclusion: always
---

# 中文开发规则

## 代码规范

### Go 语言规范
- 遵循 Go 官方代码风格指南
- 使用 `gofmt` 格式化代码
- 包名使用小写单词，不使用下划线或驼峰
- 导出的函数、类型、变量使用大写字母开头
- 私有的函数、类型、变量使用小写字母开头
- 错误处理：始终检查错误，不要忽略错误返回值
- 使用有意义的变量名，避免单字母变量（除了循环计数器）

### 注释规范
- 所有导出的函数、类型、常量必须有注释
- 注释使用英文编写，保持国际化
- 注释应该解释"为什么"而不仅仅是"是什么"
- 包注释放在 package 语句之前

### 错误处理
- 使用自定义错误类型提供更多上下文
- 错误信息应该清晰、具体
- 使用 `fmt.Errorf` 包装错误以添加上下文
- 避免使用 panic，除非是不可恢复的错误

## 项目结构

### 目录组织
- `agent/` - 智能代理核心功能
- `llm/` - LLM 提供商集成和工具
- `providers/` - 具体的 LLM 提供商实现
- `workflow/` - 工作流编排
- `examples/` - 示例代码
- `docs/` - 文档

### 文件命名
- 使用小写字母和下划线
- 测试文件以 `_test.go` 结尾
- 示例文件以 `_example.go` 结尾

## 开发流程

### 功能开发
1. 在 `.kiro/specs/` 目录创建功能规格
2. 编写设计文档 (`design.md`)
3. 分解任务 (`tasks.md`)
4. 实现功能
5. 编写测试
6. 更新文档

### 测试要求
- 单元测试覆盖核心逻辑
- 使用表驱动测试处理多个测试案例
- 测试函数命名：`Test<FunctionName>`
- 基准测试命名：`Benchmark<FunctionName>`

### 提交规范
- 提交信息使用英文
- 格式：`<type>: <subject>`
- type 类型：
  - feat: 新功能
  - fix: 修复 bug
  - docs: 文档更新
  - refactor: 重构
  - test: 测试相关
  - chore: 构建/工具相关

## 性能优化

### 最佳实践
- 避免不必要的内存分配
- 使用 sync.Pool 复用对象
- 合理使用 goroutine，避免泄漏
- 使用 context 控制超时和取消
- 使用缓存减少重复计算

### 并发安全
- 使用 mutex 保护共享状态
- 优先使用 channel 进行通信
- 避免共享内存，通过通信共享

## 依赖管理

- 使用 Go modules 管理依赖
- 定期更新依赖到稳定版本
- 避免引入不必要的依赖
- 优先使用标准库

## 文档要求

### README
- 项目简介
- 快速开始
- 功能特性
- 使用示例
- API 文档链接

### 代码文档
- 每个包都应该有包级别的文档
- 复杂的算法需要详细注释
- 提供使用示例

## 安全规范

- 不在代码中硬编码敏感信息
- 使用环境变量或配置文件管理凭证
- 验证所有外部输入
- 使用 HTTPS 进行网络通信
- 定期更新依赖以修复安全漏洞

## AI 代理开发特定规范

### 提示工程
- 提示模板应该清晰、结构化
- 使用变量占位符提高复用性
- 提供上下文信息帮助 LLM 理解

### 工具集成
- 工具定义应该包含清晰的描述
- 参数验证要严格
- 提供错误处理和回退机制

### 内存管理
- 合理设置上下文窗口大小
- 实现记忆压缩和总结
- 定期清理过期记忆

### 可观测性
- 记录关键操作日志
- 收集性能指标
- 追踪 API 调用成本
